<svelte:head>
	<title> Datalyzer Migration Tool </title>
</svelte:head>

<input style="margin-bottom:20px;" class="btn btn-primary" type="button" value="Refresh" on:click="updateJobs()" />

<br />

<table class="table">
  <thead class="thead-dark">
    <tr>
      <th scope="col">Status</th>
      <th scope="col">From series</th>
      <th scope="col">To Series</th>
			<th scope="col">Total chunks</th>
			<th scope="col">Processed chunk</th>
    </tr>
  </thead>
  <tbody>
		{#if jobList}
		{#each Object.entries(jobList) as job}

			<tr>
					<td class="vertical_center_align">
						{job[1].summary.status}
					</td>
					<td class="wrap-col">
						Measure={job[1].summary.fromChannel.measurement},
						Site={job[1].summary.fromChannel.site}
						Generator={job[1].summary.fromChannel.generator},
						Units={job[1].summary.fromChannel.units},
						Method={job[1].summary.fromChannel.method},
						Location={job[1].summary.fromChannel.location},
						Number={job[1].summary.fromChannel.number}
					</td>
					<td class="wrap-col">
						Measure={job[1].summary.toChannel.measurement},
						Site={job[1].summary.toChannel.site}
						Generator={job[1].summary.toChannel.generator},
						Units={job[1].summary.toChannel.units},
						Method={job[1].summary.toChannel.method},
						Location={job[1].summary.toChannel.location},
						Number={job[1].summary.toChannel.number}
					</td>
					<td class="vertical_center_align">
					{	job[1].summary.totalChunks}
					</td>
					<td class="vertical_center_align">
					{	job[1].summary.writeChunksProcessed}
					</td>
			</tr>
		{/each}
		{:else}
			<td colspan="6" class="text-center">
				No data
			</td>
		{/if}
  </tbody>
</table>

<style>

.wrap-col {
	vertical-align: middle;
	word-wrap: break-word;
	min-width: 160px;
	max-width: 250px;
}
.vertical_center_align{
	vertical-align: middle;
}
</style>

<script>

	import jquery from 'jquery'
	export default {
		preload(req) {
			return Promise.all([this.fetch('http://localhost:3030/api/getAllJobs').then(r => r.json()).then(jobList => {
				return {jobList}
			})
		])
		.then(([jobList]) => {
			return {...jobList}
		})
	},
	data () {
		return {
			jobList: []
		}
	},

	oncreate() {
		console.log(this.get().jobList)
	},

	methods: {
		updateJobs: function() {
			fetch('http://localhost:3030/api/getAllJobs')
			.then(r => r.json())
			.then(jobList => {
				this.set({jobList})
				console.log(this.get().jobList)
			})
		}
	}


	}

</script>
